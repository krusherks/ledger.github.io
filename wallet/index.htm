<!DOCTYPE html>
<html>
<head>
    <title>Rupaiya One Wallet | by rupaiya.one</title>
    
        <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/css/jquery-ui.css">
    <link rel="stylesheet" href="../assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="../assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="../assets/css/slicknav.min.css">
    <link rel="stylesheet" href="../assets/css/magnificpopup.css">
    <link rel="stylesheet" href="../assets/css/jquery.mb.YTPlayer.min.css">
    <link rel="stylesheet" href="../assets/css/typography.css">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/responsive.css">
    <link rel="stylesheet" type="text/css" href="index.css">
     <link rel="shortcut icon" type="image/png" href="../assets/img/icon/favicon.png">
    <link rel="apple-touch-icon" href="../assets/img/icon/apple-touch-icon.png">
</head>
<body>
    <div id="preloader">
        <div class="spinner"></div>
    </div>
    <!-- preloader area end -->
    <!-- header area start -->
    <script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Organization",
  "name" : "Rupaiya One",
 "url" : "https://rupaiya.one",
 "sameAs" : [
   "https://twitter.com/rupaiyaone",
   "https://www.facebook.com/rupaiyaone", 
   "https://www.instagram.com/rupaiyaone",
   "https://www.pinterest.com/rupaiyaone"
   ],
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "305, Shivlal Motilal Mansion, Bellasis Road",
    "addressRegion": "MH",
    "postalCode": "400008",
    "addressCountry": "IN"
  }
}
</script>
    <header id="header">
                        <div class="col-md-3 col-sm-12 col-xs-12">
                            <div class="logo">
                                <a href="../#"><img src="../assets/img/icon/logo1.png" alt="Ledger by rupaiya one - Home Page" style="color:#D7F0F7;">Rupaiya One Wallet</a>
                               
                            </div>
        </div>
    </header>
    <div class="col-md-6 col-sm-6 col-xs-12">
                <div class="row">
                    <div class="slider-inner text-right">
                        <h1>Easy Way to Send Your Rupaiya</h1>
                      <!--  <img src="../assets/img/service/eth.png" alt="ErcToken"> -->
                    </div>
                </div>
            </div>
    <div class="container" id="main">
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <br>
            <div class="field">Wallet Address: <div class="field-value" id="address"></div></div>
            <br>
            <div class="field">ETH balance: <div class="field-value" id="ethBalance"></div></div>
            <br>
            <div class="field">Token balance: <div class="field-value" id="tokenBalance"></div></div>
    
  
            <div class="field">Send : <input type="text" id="transferValue" size="10" /> <div class="field-value" id="tokenSymbol"></div></div>
            <br>
            <div class="field">To : <input type="text" id="recipientAddress" size="50" /></div>
            <br>
            <div class="button"><a class="btn" href="#" onclick="transferTokens()">Send</a></div>
       
        <div class="panel">
            <div id="transferResult"></div>
        </div>
    
    <footer>
        <div class="footer-area">
            <div class="container">
                <p>
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | powered by rupaiya.one</p>
            </div>
        </div>
    </footer>
    </div>
    <script src="web3/dist/web3.min.js"></script>
    <script src="index.js"></script>
    <script>
         handleClick = async () => {
    const { onLoggedIn } = this.props;

    // Check if MetaMask is installed
    if (!(window as any).ethereum) {
      window.alert('Please install MetaMask first.');
      return;
    }

    if (!web3) {
      try {
        // Request account access if needed
        await (window as any).ethereum.enable();

        // We don't know window.web3 version, so we use our own instance of Web3
        // with the injected provider given by MetaMask
        web3 = new Web3((window as any).ethereum);
      } catch (error) {
        window.alert('You need to allow MetaMask.');
        return;
      }
    }

    const coinbase = await web3.eth.getCoinbase();
    if (!coinbase) {
      window.alert('Please activate MetaMask first.');
      return;
    }

    const publicAddress = coinbase.toLowerCase();
    this.setState({ loading: true });

    // Look if user with current publicAddress is already present on backend
    fetch(
      `${process.env.REACT_APP_BACKEND_URL}/users?publicAddress=${publicAddress}`
    )
      .then((response) => response.json())
      // If yes, retrieve it. If no, create it.
      .then((users) =>
        users.length ? users[0] : this.handleSignup(publicAddress)
      )
      // Popup MetaMask confirmation modal to sign message
      .then(this.handleSignMessage)
      // Send signature to backend on the /auth route
      .then(this.handleAuthenticate)
      // Pass accessToken back to parent component (to save it in localStorage)
      .then(onLoggedIn)
      .catch((err) => {
        window.alert(err);
        this.setState({ loading: false });
      });
  };

  handleSignMessage = async ({
    publicAddress,
    nonce,
  }: {
    publicAddress: string;
    nonce: string;
  }) => {
    try {
      const signature = await web3!.eth.personal.sign(
        `I am signing my one-time nonce: ${nonce}`,
        publicAddress,
        '' // MetaMask will ignore the password argument here
      );

      return { publicAddress, signature };
    } catch (err) {
      throw new Error('You need to sign the message to be able to log in.');
    }
  };

  handleSignup = (publicAddress: string) => {
    return fetch(`${process.env.REACT_APP_BACKEND_URL}/users`, {
      body: JSON.stringify({ publicAddress }),
      headers: {
        'Content-Type': 'application/json',
      },
      method: 'POST',
    }).then((response) => response.json());
  };
    window.addEventListener("load", function() {
        if (!(window as any).ethereum) {
      window.alert('Please install MetaMask first.');
      return;
    }

    if (!web3) {
      try {
        // Request account access if needed
        await (window as any).ethereum.enable();

        // We don't know window.web3 version, so we use our own instance of Web3
        // with the injected provider given by MetaMask
        web3 = new Web3((window as any).ethereum);
      } catch (error) {
        window.alert('You need to allow MetaMask.');
        return;
      }
    }
       // if (typeof web3 !== "undefined") {
        // Use Mist/MetaMask's provider
     //   web3 = new Web3(web3.currentProvider);
        startApp();
      } else {
        displayProviderInfo();
      }
    });
    </script>
    <script src="../assets/js/jquery-3.2.0.min.js"></script>
    <script src="../assets/js/jquery-ui.js"></script>
    <script src="../assets/js/bootstrap.min.js"></script>
    <script src="../assets/js/jquery.slicknav.min.js"></script>
    <script src="../assets/js/owl.carousel.min.js"></script>
    <script src="../assets/js/magnific-popup.min.js"></script>
    <script src="../assets/js/counterup.js"></script>
    <script src="../assets/js/jquery.waypoints.min.js"></script>
    <script src="../assets/js/jquery.mb.YTPlayer.min.js"></script>
    <script src="../assets/js/theme.js"></script>
</body>
</html>
